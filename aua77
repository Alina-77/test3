Процедура ОбработкаПроведения(Отказ)
 
 // Проверка: чтобы не продать одно и то же место дважды
 Для Каждого СтрокаБилет Из Билеты Цикл
  
  // Запрос на проверку, продано ли уже это место на этот концерт
  Запрос = Новый Запрос;
  Запрос.Текст = 
  "ВЫБРАТЬ ПЕРВЫЕ 1
  | ПродажаБилетов.Ссылка
  |ИЗ
  | Документ.ПродажаБилетов КАК ПродажаБилетов
  |ГДЕ
  | ПродажаБилетов.Концерт = &Концерт
  | И ПродажаБилетов.Место = &Место
  | И ПродажаБилетов.Ссылка <> &ТекущийДокумент";
  
  Запрос.УстановитьПараметр("Концерт", СтрокаБилет.Концерт);
  Запрос.УстановитьПараметр("Место", СтрокаБилет.Место);
  Запрос.УстановитьПараметр("ТекущийДокумент", Ссылка);
  
  Если НЕ Запрос.Выполнить().Пустой() Тогда
   Отказ = Истина;
   Сообщить("Место " + СтрокаБилет.Место + " на концерт уже продано!");
   Возврат;
  КонецЕсли;
  
 КонецЦикла;
 
КонецПроцедуры